global
  daemon
  log stdout local0
  maxconn 50000

defaults
  mode http
  log global
  option dontlognull
  option httpclose
  option redispatch
  timeout connect 3000    # 3 seconds
  timeout client  300000  # 5 minutes
  timeout server  300000  # 5 minutes

frontend public
  bind *:80
  option httplog
  option forwardfor

  acl url_devserver path_beg /sockjs-node
  acl url_static path_beg /static
  acl url_static path_end .css .gif .html .jpg .js .png
  use_backend webserver if url_static url_devserver

  acl ethprovider_path path_beg /api/ethprovider
  use_backend ethprovider if ethprovider_path

  acl messaging_path path_beg /api/messaging
  use_backend messaging if messaging_path

  acl api_path path_beg /api
  use_backend node if api_path

  default_backend webserver


backend ethprovider
  http-request replace-path /api/ethprovider /
  server ethprovider "$ETH_RPC_URL"

backend messaging
  server nats "$MESSAGING_WS_URL"

backend node
  http-request replace-path /api/(.*) /\1
  server node "$NODE_URL"

backend webserver
  server webserver "$WEBSERVER_URL"
